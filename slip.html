<!DOCTYPE html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Packing Slip Generator</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/slip.css" rel="stylesheet">
    <link href="css/packingSlip.css" rel="stylesheet">

    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
    <!-- AngularFire -->
    <script src="https://cdn.firebase.com/libs/angularfire/1.1.3/angularfire.min.js"></script>

    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/onLoad.js"></script>
    <script src="js/appPS.js"></script>
    <script src="js/appFunctions.js"></script>
  </head>
  <body ng-controller="appCtrl" class="container">
    <!-- The user must first login before they can use the application -->
    <div ng-show="!access" class="no-print">
      <h1 class="col-12 title"><a class="headerHome" href="index.html"><img class="logo" src="images/logo.png"> Packing Slip Generator</a></h1>

      <div class="login-card">
        <h2>Log-in</h2><br>
        <form>
          <input type="text" name="user" placeholder="Email" ng-model="userName">
          <input type="password" name="pass" placeholder="Password" ng-model="password">
          <input type="submit" name="login" class="login login-submit" value="login" ng-click="login()">
        </form>
      </div>
    </div>

    <!-- If the user has logged in they can use the functions -->
    <div ng-show="access">
      <div class="no-print">
        <div class="white"></div>
        <h1 class="col-12 title"><a class="headerHome" href="index.html"><img class="logo" src="images/logo.png"> <span ng-show="!invoice">Packing Slip Generator</span><span ng-show="invoice">Invoice Slip Generator</span></a></h1>

        <div class="greeting">
          <p>
            Hi, {{name}}! <br class="greetingBreakline"><button class="clean-gray-btn" ng-click="logout()">Logout</button><span ng-show="!selectedCustomer.name==''"><button class="clean-gray-btn" ng-click="loadData()">Load last order</button></span>
            <br>
            Change to: <button class="clean-gray-btn" ng-click="changeView()"><span ng-show="!invoice">Invoice Slip</span><span ng-show="invoice">Packing slip</span></button>
          </p>
        </div>
        <textarea id="notes" ng-model="notes" placeholder="Notes"></textarea>

        <div id="customerDetails" class="center">
          <span ng-show="!invoice">Backorder: <input ng-model="backOrder" type="checkbox">
          <strong>| </strong></span><input ng-model="orderNo" onclick="this.select()" placeholder="Order no.">
          <strong>| </strong> Date: <input id="datePicker" type="date" onclick="this.select()" ng-model="date">
          <strong>| </strong> <input id="searchBox" type="text" ng-model="searchBox" placeholder="Item search">
          <br>
          <h2><span ng-show="invoice">New: <input ng-model="invoiceNewCustomer" ng-click="resetCustomer()" type="checkbox"> | </span>Customer: <span ng-show="!invoiceNewCustomer">{{selectedCustomer.name}}</span> <span ng-show="invoiceNewCustomer"><input ng-model="selectedCustomer.name" placeholder="Name"> <input ng-model="selectedCustomer.address" placeholder="Address"></span></h2>

          <hr>
        </div>

        <div id="mainBody">
          <nav>
            <ul>
              <li class="center row" ng-show="!invoice">
                <span ng-repeat="customerList in customers | limitTo: 5" ng-click="showList(customerList)" class="clean-gray-btn customerList">{{customerList.name}}</span>
              </li>
              <li class="center row" ng-show="invoice">
                <span ng-click="showList(customers[5])" class="clean-gray-btn customerList">Invoice customers</span>
              </li>
              <li ng-repeat="customerList in customers">
                <ul class="shopList" ng-show="customerList.show">
                  <li ng-repeat="branch in customerList.array" ng-click="listClick(branch)" class="clean-gray-btn clean-gray-btn-shop">{{branch.name}}</li>
                </ul>
              </li>
            </ul>
          </nav>

          <div class="itemList">
            <form id="orderForm" ng-submit="printPreview()">
              <span ng-repeat="item in displayedItems" class="row item">
                <strong class="col-12">
                  <!-- If the item is a heavy duty resealable bag then the item will show red -->
                  <span ng-show="item.code.indexOf('RE0') == 0 && item.code.indexOf('H') == 5" style="color: red">{{item.description}} {{item.packaging}}:</span>
                  <!-- If the item is a black foam plate then the item will show red -->
                  <span ng-show="item.code.indexOf('FP') == 0 && item.code.includes('B')" style="color: red">{{item.description}}:</span>
                  <span ng-show="!((item.code.indexOf('RE0') == 0 && item.code.indexOf('H') == 5) || (item.code.indexOf('FP') == 0 && item.code.includes('B')))">{{item.description}}<span ng-show="item.code.includes('RE0')"> {{item.packaging}}</span>:</span>
                </strong>
                <input ng-change="checkoutList()" ng-model="item.ordered" type="number" value="0" min="0" step="0.01" class="col-7" onclick="this.select()">
                <span class="col-4">
                  {{item.orderAs}}
                  <button type="button" class="clean-gray-btn clean-gray-btn-increment" ng-click="item.ordered = item.ordered+1; checkoutList()">+</button>
                  <button type="button" class="clean-gray-btn clean-gray-btn-increment" ng-click="item.ordered = item.ordered-1; checkoutList()">-</button>
                </span>
                <br>
              </span>
              <input class="printBtn clean-gray-btn" type="submit" value="Print"/>
            </form>
            <img src="images/arrow-up.png" class="backToTop" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast')"></img>
            <br>
          </div>
        </div>

        <!-- The checkout list for packing slip view -->
        <div id="checkout"  ng-show="!invoice">
          <div id="checkoutHeader">
            <br>
            <h2>Items</h2>
            <hr>
          </div>
          <div id="checkoutItems">
            <p ng-repeat="item in checkoutItems">
              <strong>{{item.description}}:</strong><br>
              {{item.ordered}} {{item.orderAs}}
              <button type="button" class="clean-gray-btn checkoutButtons" ng-click="item.ordered = 0; checkoutList()">X</button>
              <button type="button" class="clean-gray-btn checkoutButtons" ng-click="item.ordered = item.ordered-1; checkoutList()">-</button>
              <button type="button" class="clean-gray-btn checkoutButtons" ng-click="item.ordered = item.ordered+1; checkoutList()">+</button>
            </p>
          </div>
        </div>

        <!-- The checkout list for invoice view -->
        <div id="invoiceCheckout" ng-show="invoice">
          <div id="invoiceInnerItems">
            <table id="invoiceTable">
              <tr>
                <th>Description</th>
                <th>Quantity</th>
                <th class="invoiceCheckoutButtonsTable"></th>
                <th class="invoicePrice">Price</th>
                <th>Total</th>
              </tr>
              <tr ng-repeat="item in checkoutItems">
                <td>{{item.description}}</td>
                <td>{{item.ordered}} {{item.orderAs}}</td>
                <td>
                  <button type="button" class="clean-gray-btn invoiceCheckoutButtons" ng-click="item.ordered = 0; checkoutList()">X</button>
                  <button type="button" class="clean-gray-btn invoiceCheckoutButtons" ng-click="item.ordered = item.ordered-1; checkoutList()">-</button>
                  <button type="button" class="clean-gray-btn invoiceCheckoutButtons" ng-click="item.ordered = item.ordered+1; checkoutList()">+</button>
                </td>
                <td><form><strong ng-show="item.wrongPrice">*</strong><label>$</label><input class="invoicePriceInput" type="number" ng-change="priceChange(item)" ng-model="item.tempPrice" ng-keyup="defineTotalPrice()" min="0" step="0.01" onclick="this.select()"></form></td>
                <td>{{item.tempPrice*item.ordered | currency}}</td>
              </tr>
            </table>
          </div>

          <table id="invoiceTotalTable">
            <tr>
              <th><span ng-show="selectedCustomer.includeGST">Total including GST</span><span ng-show="!selectedCustomer.includeGST">Sub total</span></th>
              <td>{{subTotal | currency}}</td>
            </tr>
            <tr ng-show="!selectedCustomer.includeGST">
              <th>GST</th>
              <td>{{gst | currency}}</td>
            </tr>
            <tr ng-show="!selectedCustomer.includeGST">
              <th>Total</th>
              <td>{{grandTotal | currency}}</td>
            </tr>
          </table>
        </div>
      </div>

      <div id="packingSlip">
        <div ng-repeat="n in [0,1]">
          <div class="row">
            <h1 class="col-10 packingTitle"><img class="logo"src="images/logo.png"> FORTUNE ENTERPRISES CO (NZ) LTD</h1>
            <strong class="col-2 packingName" ng-if="invoice === true">Invoice Slip</strong>
            <strong class="col-2 packingName" ng-if="invoice !== true">Packing Slip</strong>
          </div>

          <div class="row packingRow">
            <div class="col-8">
              <p class="packingP">73 Huia Road, Otahuhu, Auckland</p>
              <p class="packingP">PO Box 9511 New Market, Auckland</p>
              <p class="packingP">Email: <a href="#">feltd@xtra.co.nz</a></p>
            </div>
            <div class="col-4">
              <p class="packingP">Phone:    (09) 276-8681</p>
              <p class="packingP">Fax:      (09) 276-8682</p>
              <p class="packingP">Website:  <a href="#">www.fortunenz.com </a></p>
            </div>
          </div>

          <div class="row packingRow">
            <div class="col-8">
              <p class="packingP">Deliver to:</p>
              <p class="packingP"><strong>{{selectedCustomer.name}}</strong></p>
              <p class="packingP">{{selectedCustomer.address}}</p>
              <p class="packingP">{{selectedCustomer.city}}</p>
            </div>
            <div class="col-4">
              <p class="packingP" ng-if="invoice === true">Invoice slip no.: {{slipNumber.$value}}</p>
              <p class="packingP" ng-if="invoice !== true">Packing slip no.: {{slipNumber.$value}}</p>
              <p class="packingP">Account no.: {{selectedCustomer.acc}}</p>
              <p class="packingP">Order no.: {{orderNo}}</p>
              <p class="packingP">Date: {{slipDate}}</p>
            </div>
          </div>

          <div class="center" ng-if="backOrder === true && invoice === false">
            <strong>Backorder</strong>
          </div>

          <table class="packingTable">
            <tr>
              <th class="packingT">Code</th>
              <th class="packingT">Description</th>
              <th class="packingT" ng-if="invoice !== true">Packaging</th>
              <th class="packingT">Quantity</th>
              <th class="packingT">Carton</th>
              <th class="packingT" ng-if="invoice === true">Price</th>
              <th class="packingT" ng-if="invoice === true">Total</th>
            </tr>
            <tr ng-repeat="item in items" ng-if="item.ordered > 0">
              <td class="packingT">{{item.code}}</td>
              <td class="packingT">{{item.description}}</td>
              <td class="packingT" ng-if="invoice !== true">{{item.packaging}}</td>
              <td class="packingT">{{item.ordered | quantity:item}}</td>
              <td class="packingT">{{item.ordered | carton:item}}</td>
              <td class="packingT" ng-if="invoice === true">{{item.tempPrice | currency}}</td>
              <td class="packingT" ng-if="invoice === true">{{item.tempPrice * item.ordered | currency}}</td>
            </tr>
          </table>

          <div class="packingTotalTable right" ng-if="invoice === true">
            <table ng-if="selectedCustomer.includeGST !== true">
              <tr>
                <th class="packingT">Sub Total</th>
                <td class="packingT">{{subTotal | currency}}</td>
              </tr>
              <tr>
                <th class="packingT">GST</th>
                <td class="packingT">{{gst | currency}}</td>
              </tr>
              <tr>
                <th class="packingT">Total</th>
                <td class="packingT">{{grandTotal | currency}}</td>
              </tr>
            </table>
            <table ng-if="selectedCustomer.includeGST === true">
              <tr>
                <th class="packingT">Total including GST</th>
                <td class="packingT">{{subTotal | currency}}</td>
              </tr>
            </table>
          </div>

          <br><br>
          <div class="packingSign" ng-if="selectedCustomer.city == 'Auckland'">
            <p>Name: _________________________________</p><br>
            <p>Signature: ______________________________</p>
            <p class="packingPaymentInfo" ng-if="invoice === true && selectedCustomer.acc !== ' '">Please pay direct to bank account: Westpac 03-0166-0248508-00</p>
          </div>

          <div class="packingNotes" ng-if="notes.trim().length !== 0">
            <p class="packingNotesInner">{{notes}}</p>
          </div>

          <!-- Inserts a page break is this is the first of two pages -->
          <div class="break" ng-if="$index === 0"></div>
        </div>

        <div class="shippingLabel" ng-repeat="n in shippingLabel track by $index">
          <br><br><span ng-show="selectedCustomer.shippingComment === undefined"><br><br><br></span>
          <p>{{selectedCustomer.name}}</p>
          <p>{{selectedCustomer.address}}</p>
          <p>{{selectedCustomer.city}}</p>
          <span ng-show="selectedCustomer.shippingComment !== undefined">
            <br>
            <p>{{selectedCustomer.shippingComment}}</p>
          </span>
        </div>
      </div>
    </div>
  </body>
</html>
